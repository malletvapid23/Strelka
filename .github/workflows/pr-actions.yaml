name: pr-actions
on: [pull_request]

jobs:
  backend-strelka-test:

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:

          python-version: '3.x'

          architecture: 'x64'
      - name: Install dependencies
        run: |
          sudo apt-get -q update
          sudo apt-get install --no-install-recommends -qq \
          automake \
          build-essential \
          curl \
          gcc \
          git \
          libglu1-mesa \
          libtool \
          make \
          swig \
          python3-dev \
          python3-pip \
          python3-wheel \
          pkg-config \
          antiword \
          libarchive-dev \
          libfuzzy-dev \
          libmagic-dev \
          libssl-dev \
          libzbar0 \
          libgl1 \
          python3-setuptools \
          redis-server \
          tesseract-ocr \
          unrar \
          upx \
          jq && \
          sudo curl -OL https://github.com/exiftool/exiftool/archive/refs/tags/12.52.tar.gz && \
          sudo tar -zxvf 12.52.tar.gz && \
          sudo cd exiftool-12.52/ && \
          sudo perl Makefile.PL && \
          sudo make && \
          sudo make install && \
          python -m pip install --upgrade pip
          pip install validators setuptools --upgrade
          pip install --no-cache-dir -r src/python/requirements.txt
      - name: Test with pytest
        run: |
          pytest
      

